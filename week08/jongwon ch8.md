```toc
```


## 8.1 온라인 쇼핑몰 시스템 만들기
- 상품 검색, 구매, 원하는 주소로 배송
- 구현하고자 하는 기능은 아래와 같음

### 8.1.1 상품 목록
- 원하는 상품 검색, 그 결과로 필요한 상품 정보 전달, 구매 결정에 영향을 줄 수 있는 상품 목록 기능 제공
- 핵심 기능
	- 상품 검색
	- 상품 상세 정보 제공을 통해 구매 의사 결정에 도움을 줌
	- 상품 관리자와 판매자들이 상품을 추가하고 제거, 정보 변경

### 8.1.2 주문 관리
- 구매 결정하면 수량 정하고 장바구니에 추가
- 장바구니에 담은 상품 결제, 구매

### 8.1.3 주문 추적 및 배송 예측
- 주문이 처리되면 고객은 주문 내용을 받아보고, 배송 현황이 변경되면 알림 받기
	- 배송 현황 추적
	- 주문 상태나 변경 상태, 예상 배송 일자 변경 등 중요 정보 변경 시 알림
	- 배송 예측 일자 제공 : 과거 주문 내역, 현재 물류 시스템 실시간 현황, 배송 서비스 등을 토대로 예상되는 배송 일자를 고객에게 제공

### 8.1.4 상품 추천
- 검색 상품, 과거 구매 내역, 현재 판매 중인 상품 토대로 추천

### 8.1.5 고객 및 협력사 관리
- 계정, 프로필 정보 관리
- 모바일, 웹 등 다양한 종류의 애플리케이션으로 접근 가능
- 이는 고객뿐만 아니라 협력사 등 여러 프론트에게 제공 필요

- 그 외에도 고가용성, 확장성, 보안성, 관측 가능성 등 제공 필요
- 온프레미스, 퍼블릭 클라우드 플랫폼 등 모든 환경에서 동적 관리 가능

## 8.2 고수준 아키텍처 만들기
![](files/Pasted%20image%2020251123175534.png)
- 위에서 이야기한 기능을 마이크로서비스로 구현
- 이런 비즈니스 기능들을 관리형 API를 통해 프론트에게 제공
	- 비즈니스 기능을 더 자세히 제어하고 관리하기 위해 관리형 API 사용

- 애플리케이션 아키텍처는 프론트에서 시작해서 시스템 전체를 연결하는 API 관리 계층으로 연결됨
- 모든 웹, 모바일 애플리케이션은 이 API 계층을 사용해서 만들어짐
- API들은 비즈니스 기능을 구현한 로직을 가지고 있는 마이크로서비스와 연결됨

- 마이크로서비스 간 내부 통신은 서비스 연결성 패턴, 서비스 조합 패턴, 이벤트 주도 패턴 등 통신 패턴으로 구현됨
- 마이크로서비스는 레거시 ERP 등 클라우드 네이티브 애플리케이션으로 개발되지 않은 내부 혹은 외부 시스템과 연결될 수 있음
- 전체 시스템은 컨트롤 플레인을 통해 확장성, 고가용성, 보안, 관측가능성 등 범용 기능 제공

## 8.3 외부 API 만들기
![](files/Pasted%20image%2020251123175941.png)
- 비즈니스 기능을 파악하고 이를 바탕으로 로직으로 구현하거나, 마이크로서비스와 외부 시스템, 데이터베이스, 그 외 자원과 조합해서 구현

- 외부 클라이언트는 부하 분산 계층을 통해 API를 사용할 수도 있고, BFF를 쓸 수도 있음
- 위 그림에서는 주문 API에 모바일과 웹 애플리케이션을 위해 BFF를 적용함

- 대부분의 API 트래픽은 API 게이트웨이를 통해 RESTful, GraphQL 방식으로 제공됨
- 보안, 스로틀링, 캐싱, 정책 적용 등은 API 게이트웨이 계층에서 제공
- API 런타임은 API 마이크로게이트웨이 패턴을 쓸 수 있음

- API 소유권은 해당 API에서 사용하는 기저 마이크로서비스의 소유권을 가진 팀이 가짐

## 8.4 서비스 연결
![](files/Pasted%20image%2020251123180156.png)
- 비즈니스 로직을 마이크로서비스에 구현하면 이를 통합하고 연결해야 함
- 마이크로서비스는 다른 서비스를 호출함
- 적절한 통신 프로토콜을 선택하고 이를 서비스 개발에 사용

- 서비스 연결할 때는 연결성 패턴 대부분 사용 가능
- 타임아웃, 재시도, 회로 차단기 등
- 서비스 메시, 서비스 오케스트레이션, 서비스 코레오그래피 패턴

## 8.5 데이터 관리
![](files/Pasted%20image%2020251123180306.png)
- 데이터를 분산해야 결합도를 낮추고 마이크로서비스에 맞는 데이터 관리 기법, 데이터 스토어 선택 가능

- 재고 서비스는 재고 목록, 수량 관리를 위해 별도의 관계형 데이터베이스 사용
- 상품 목록은 NoSQL 사용
- CQRS 패턴 등으로 상품 목록 서비스를 여러 개의 독립적인 서비스로 나눌 수 있다
	- 명령 부분은 RDBMS, 조회는 NoSQL 등등

- 여러 서비스 컴포넌트 간 약한 데이터 일관성 동기화는 이벤트를 통해 제공될 수 있음
	- NATS, 카프카 등

- 저장하는 데이터 종류에 따라 별도 데이터 스토어를 쓸 수도 있다
	- 이미지, 비디오 등은 블롭 스토어 등 이진 데이터 스토어에 저장
	- 상품 데이터베이스에는 참조 정보만 저장

## 8.6 이벤트 주도 아키텍처
![](files/Pasted%20image%2020251123180601.png)
- 주문과 관련된 상태 변경 이벤트를 추적하고 배송, 주문 추적 서비스에서 이를 처리할 수 있도록 만들어야 한다

- 주문이 만들어지면 주문 서비스는 주문 메시지를 큐에 넣는데, 결과로 이벤트 소비자에게 주문 요청을 처리하라는 명령이 만들어진다
- 배송 서비스는 주문 큐에서 메시지를 가져와서 사용

- 주문 관련 이벤트는 여러 소스에서 만들어지므로 CloudEvents와 같은 공통 이벤트 표현 방식을 사용

## 8.7 스트림 프로세싱
![](files/Pasted%20image%2020251123180800.png)
- 배송 예측 기능은 스트림으로 구현 가능
- 예측 기능의 핵심은 실시간 재고 현황, 과거 주문 데이터, 배송 회사에서 제공하는 실시간 정보를 토대로 고객이 주문한 상품의 예상 배송 일자를 제공
- 이를 위해 여러 소스로부터 받은 이벤트를 받아서 처리하는 MS를 만들 수 있음
- 이런 이벤트는 분산 이벤트 브로커나 데이터 스토어에 저장 가능

- 비즈니스 로직은 필터와 한계값, 윈도우드 애그리게이션 등 실시간 패턴을 사용해 배송 이벤트를 처리하고 배송 패턴을 파악하는 부분과 스트림 조인 패턴, 스트림 변환 패턴 등으로 처리 결과를 수정하고, 이를 다시 다른 서비스로 보낸다.

- 스트림 프로세싱은 상황에 맞게 여러 프로세싱 기술을 사용해서 구현 가능
- 위 그림은 아파치 플링크와 KSQL 씀
- 이런 배송 예측 서비스는 특정 배송에 대한 요청 처리는 물론 해당 배송에 대한 변경 사항이 발생하면 알림을 보낼 수 있음
- 머신 러닝 등도 적용 가능


## 8.8 클라우드 환경에서 동적 관리 기능 구현
- 대부분은 클라우드 서비스 그대로 사용해서 관리
- 물론 데이터 센터 사용해서 바닥부터 관리 기능 만들 수도 있음
- 여기서는 클라우드 쓴다고 가정

- 기술 요소
	- 원하는 어떤 기술이든 가능
- 자동화된 개발, 릴리스, 배포
	- 클라우드 플랫폼에서 제공하는 CI/CD
- 동적 런타임 환경에서 실행
	- 확장 가능, 고가용성을 위해 컨테이너, 쿠버 등 사용
- 지원 서비스 사용
	- 이벤트 브로커, DB, 캐시 등의 지원 서비스로 비즈니스 기능을 구현하기도 함
	- 관리형 서비스로 쓰면 고가용성, 보안, 자동화된 확장, 탄력성 등 제공
- 서비스 연결성
	- 서비스 검색, 서비스 탄력성, 라우팅, 완전 관리형 서비스 메시 등 클라우드 서비스로 제공 받을 수 있음
- 보안
	- 전송 계층 수준 보안, OAuth2, OpenID Connect 등 애플리케이션 계층 수준
- 관측 가능성
	- 메트릭, 로그, 등등
- 하이브리드 및 멀티클라우드 배포를 위한 단일 컨트롤 플레인
	- 꼭 단일 클라우드 플랫폼일 필요는 없음
	- 여러 클라우드 혹은 온프레미스에서 가능
	- 단일 클라우드 플랫폼에서 여러 곳에 분산된 워크로드 관리
	- 애저 ARC, 구글 Anthos 등


## 8.9 마치며

