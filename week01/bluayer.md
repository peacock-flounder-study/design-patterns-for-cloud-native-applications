# 클라우드 네이티브 애플리케이션이란?

## 클라우드 네이티브의 개념

> 클라우드 네이티브란 퍼블릭이나 프라이빗, 하이브리드, 멀티 클라우드와 같은 환경에서 실행할 수 있는 독립적인 비즈니스 기능 중심의 마이크로서비스들을 느슨하게 결합하여, 크기 조절이 가능하고 탄력적이며 관리와 관찰이 용이한 자동화된 소프트웨어 애플리케이션을 만드는 것을 의미한다.

### 마이크로서비스로 구성하는 설계

클라우드 네이티브 애플리케이션은 독립적으로 만들어진 서비스들을 느슨하게 결합하는 것으로 설계됩니다.

SOA(특정 비즈니스 기능을 지원하는 서비스들을 조합하여 SW App을 만듦) + ESB(Enterprise service bus) -> MSA(중앙화 컴포넌트를 제거)

### 컨테이너와 컨테이너 오케스트레이션

패키징과 실행에서 컨테이너가 MSA만큼 중요한 역할을 담당.

**컨테이너란?**

컨테이너 이미지는 수정이 불가능하며 컨테이너 레지스트리(container registry)라는 스토어에 주로 보관

컨테이너는 컨테이너 이미지를 통해 컨테이너 인스턴스(container instance)라고 불리는 프로세스를 만들어서 실행 컨테이너 인스턴스는 컨테이너 런타임 엔진에서 실행

컨테이너화를 통해 마이크로서비스를 좀 더 옮기고 쉽고 여러 환경에서도 동일하게 실행되도록 만들 수 있음.

**왜 컨테이너 오케스트레이션이 필요한가?**

컨테이너 오케스트레이션은 컨테이너의 라이프사이클을 관리하는 일종의 쳬계. 각각의 컨테이너를 수동으로 직접 관리하는 것은 사실 불가능.

핵심 기능 :
- 자동화된 프로비저닝 (automatic provisioning)
- 고가용성(HA)
- Scaling
- Resource management
- Service interface & Load balancing
- Networking infrastructure abstraction (overlay 네트워크를 제공하여 컨테이너 간 통신을 가능하게)
- Service Discovery
- Control plane
- Affinity : 필요에 따라 컨테이너들을 가까이, 또는 서로 멀리 배치함으로써 가용성 또는 목표 성능을 달성할 수 있도록 합니다.
- Health Monitoring (for self healing)
- Rolling upgrade
- Componentization & isolation

**쿠버네티스**

쿠버네티스는 애플리케이션 워크로드를 이식이 쉽고 크기 조절이 자유로우며 확장이 쉽도록 만들어줍니다.

쿠버네티스 API 서버는 컨트롤 플레인 노드들과 워커 노드들 사이의 모든 통신을 도맡습니다.

특정 애플리케이션 워크로드가 워커 노드에서 실행되어야 하는 경우 : kube-scheduler

각 쿠버네티스 노드 : 노드 상태를 관리하는 kubelet 에이전트가 실행

**서버리스**, **가상 머신**

### 개발 라이프 사이클을 자동화하기

배포를 어디에 어떤 식으로 할 것인지 결정하고 나면, 쿠버네티스와 같은 플랫폼에서 조정 루프(reconciliation loop)를 통해 배포 상태를 계속 관리할 수 있습니다.

***사용자, 관리자 개입 없이 배포 상태를 알아서 관리하고 유지하는 것입니다.***

### 동적 관리

클라우드 네이티브 애플리케이션 : 동적으로 관리해야 할 핵심적 기능

- Auto scaling
- HA
- Resource optimization
- Observabtility
- QoS : E2E Security, Throttling, compliancy, versioning
- Central control plan
- Resource provisioning
- Multicloud support

## 클라우드 네이티브 애플리케이션 개발 방법론

Twelve-Factor app 개발 방법론은 애플리케이션 개발 주기에 안 맞는 경우가 있었음.

### 애플리케이션 설계

설게 과정에서 애플리케이션이 제공해야 할 비즈니스 핵심 기능 + 애플리케이션이 사용할 서비스나 시스템 등 외부 의존성 관계 파악이 필요.

일반적으로 bounded context 별로 서비스를 만들고, 설계를 진행하면서 점차 aggregate 단위로 서비스를 잘게 쪼개는 경향이 있음

### 애플리케이션 개발

애플리케이션과 서비스 인터페이스들을 구현

**독립 코드 베이스**

각 마이크로서비스는 버전 관리 시스템 기반 코드베이스를 가지고, 코드 베이스는 같지만 각기 다른 독립적인 환경에 배포/실행

**명시적 의존성**

마이크로서비스 코드 수준 의존성은 반드시 명시적으로 선언해야 함.

**별도의 설정 관리**

**독립 테스트**

단위 테스트 만으로는 충분하지 않고 통합 테스트를 해야 함. (https://martinfowler.com/articles/microservice-testing/)

**컨테이너화**

컨테이너화는 필수가 아니지만 이를 통해 대부분의 특성과 요구사항을 쉽게 구현하는 것이 가능

마이크로서비스 코드를 immutable하게 만들어서 원하는 시점에 즉각 시작, 중지할 수 있음.

### 연결성 및 구성, 그리고 API

서비스 간 연결성을 확보하고 API와 서비스 인터페이스를 잘 정의하는 것이 아주 중요

**서비스 주도 상호작용**

마이크로서비스와 애플리케이션은 자신의 기능을 서비스로 외부에 제공.

필요한 서비스를 동적으로 찾을 수도 있으며 서비스 메타 정보를 레지스트리나 스토어에 저장할 수도 있음.

**서비스 간 통신 및 조합

내부 서비스 간, 또는 애플리케이션과 외부 서비스 간 상호작용은 클라우드 네이티브 애플리케이션의 필수 요소

circuit breaker, timeout, backoff를 가지는 재시도 기능과 같은 탄력적인 통신, 라우팅, 메트릭 수집 및 보고 등 비즈니스 기능에 포함되지 않는 특정 기능들도 서비스 간 상호 작용

**관리형 API로 기능들을 외부에 제공하기**

서비스 개념을 확장해서 managed API로 제공. API Gateway와 API management, control plane을 통해 보안, 스로틀링, 캐싱, 버전 관리 등 기능을 구현.

### 개발, 릴리스, 배포 자동화

가능한 자동화하기

### 동적 환경에서 실행

핵심은 애플리케이션이 실행 환경과는 완전히 독립적이며, 개발이나 검증, 운영 같은 다양한 환경에서 애플리케이션 코드 수정 없이 실행이 가능해야 한다는 점.

쿠버네티스와 같은 컨테이너 오케스트레이션 플랫폼은 기본적으로 애플리케이션을 Stateless process로 간주하고 실행

### 동적 환경 관리를 위한 컨트롤 플레인

애플리케이션이 실행될 동적 환경을 제어할 수 있는 중앙 관리 도구와 컨트롤 플레인을 사용

REST, RPC API로 제공

### 관측 가능성 및 모니터링

새로운 코드를 실행하지 않고도 애플리케이션의 상태를 이해하고 설명할 수 있는 능력

## 클라우드 네이티브 애플리케이션 디자인 패턴

기존과는 아주 큰 차이. 

### 통신 패턴

서비스들이 서로, 또는 외부 요소와 어떻게 통신하는지

동기 통신 : Request-response, RPC
비동기 통신 : MQ, publisher-subscriber

### 연결성 및 조합 패턴 (Connectivity and composition pattern)

내부 서비스 간 통신의 복잡도를 줄이기 위해 특정 기능이나 추상화가 필요

**연결성**

서비스 간 믿을 수 있고 안전하며, 찾기 쉽고 관리가 편하며 관측 가능성이 뛰어난 통신 매체를 제공하는 것.

**조합**

여러 서비스나 시스템을 연결, 통합하여 새로운 서비스를 만듦

### 데이터 관리 패턴

비즈니스 데이터 저장 -> 데이터베이스

마이크로서비스가 자신만의 데이터를 가짐 -> 다른 서비스나 외부 시스템은 서비스 인터페이스만을 통해 접근 -> 마이크로서비스 간 데이터 공유, 접근, 동기화가 어려워짐

### 이벤트 주도 아키텍처 패턴 (EDA)

마이크로서비스를 독립적이고 장류적으로 동작할 수 있도록 만드는 중요한 역할. 느슨하고 유연하게.

### 스트림 프로세싱 패턴

EDA에서는 한 번에 하나의 이벤트만 처리

Stream은 서로 밀접한 관계를 가지며 시간에 따라 지속적으로 유입되는 일련의 이벤트나 데이터들 -> 애플리케이션이 현재 상태를 계속 저장하고 관리하면서 처리해야 함(stateful)

일반적인 EDA 형식으로 안되기 때문에 스트림 프로세싱이 필요해짐.

### API 관리 및 사용 패턴

애플리케이션의 특정 비즈니스 기능들을 내부 혹은 외부 시스템에 제공하는 경우가 많음. 애플리케이션에 접근할 수 있는 대문인 API Gateway를 둠

## 쿨라우드 네이티브 애플리케이션 참조 모델

그림 보기~
