# Chapter 4. 데이터 관리 패턴

## 데이터 관리

- 중앙 데이터 관리
- 분산 데이터 관리
- 하이브리드 데이터 관리 -> 바운디드 컨텍스트 안에 존재한다고 하지만, 옳게 된 방향이 맞을까

## 데이터 조합 패턴

지연 시간을 어떻게 줄일까?

- 데이터 서비스 패턴 : 데이터베이스의 데이터를 서비스 형태로 제공 (데이터 서비스). 여러 서비스가 같은 데이터에 접근하거나 추상화하려는 경우. => LMCache
- 조합 데이터 서비스 패턴 (Server-side mashup pattern) : 결국 데이터 서비스도 쪼개자
- Client-side mashup pattern : RIA(Rich Internet Application), 중요한 데이터를 낮은 지연 시간으로, 웹 페이지를 더 빨리 불러오는 효과를 줌

## 데이터 확장 패턴

- 데이터 샤딩 패턴 : 수평 / 수직 / 기능 / 디렉토리 / 범위 / 해쉬. 고려해야 할 게 많다고 하는데, 여전히 어려운 일이 맞다. 샤드의 불균형과 재배치가 쉬운 것처럼 서술했지만, 절대로 그렇지 않다. 데이터를 uptime 중에 옮길 수 있을지 고민해봐야 함.
- CQRS

## 성능 최적화 패턴

기본적인 방법

- 색인
- 데이터 비정규화
- preprocessing

실제로 어느 지점에 도달하면, Network Latency가 가장 큰 성능 병목 지점이라고 느껴지게 된다. 우린 어떻게 해결할 수 있을까?

- materialized view pattern : 복잡한 조인 연산을 제거하고 관련 서비스에 대한 결합도를 낮춤. 데이터 일관성에 민감하면 안됨
- data locality pattern : 데이터 처리 로직을 데이터와 가까운 곳에서 실행. 데이터 노드의 CPU 자원 사용 최대화 가능, 네트워크 대역폭 소비 감소.
- 캐싱 패턴 : 이 책에서 작게 다루는 cache invalidation이 현재 프로덕션 시스템에서 가장 어려운 일. 다계층 폴백 캐시는 정말 많이 쓰는 구조. 락이 필요한가? 는 고민해보기
- 정적 콘텐츠 호스팅 패턴 : 여전히 어렵다. EPOP 같은 것도 쓰긴 하는데 요즘.. mid-mile을 늘리는 방법은 어려운 일인 듯 하다.

다 좋지만, data consistency 문제가 여전히 발목을 잡는다. 그리고 event sourcing pattern을 몹시 쉽게 생각하는 경향이 있는데, 실제 프로덕션도 가능한가?

## 신뢰성 패턴

- 트랜잭션 패턴

## 보안 : 볼트 키 패턴

신뢰할 수 있는 토큰을 가지고 데이터 스토어에 직접 접근. 토큰이 볼트 키.
refresh token을 통해 새로운 볼트 키를 발급 받을 수 있음.
=> 가장 큰 문제는 클라이언트 측 구현이 제대로 되어 있어야 한다는 점. 공통 플랫폼 형식으로 관리하나?

## 데이터 관리 패턴 구현 기술
- RDBMS
- 아파치 카산드라 : 쓰기 성능이 읽기 성능에 비해 훨씬 좋다. 데이터 자주 업데이트 좋지 않다.
- 아파치 HBase : columnar store. HDFS에서 동작 -> 다른 시스템에 상호 의존적이며 설정이나 보안, 유지 관리가 더 어려움. 카산드라와 달리 마스터/워커 배포를 사용하기 때문에 단일 장애점.
- MongoDB : 색인에 더 민감
- Redis
- DDB
- 아파치 HDFS : 순차 읽기 최적화. 크기가 큰 적은 수의 파일을 저장하는 것이 좋음
- Amazon S3
- Azure cosmosDB
- Spanner

## 테스팅

데이터 서비스와의 상호작용을 통해 테스트

- 데이터 스토어 타입과 버전을 테스트하기. 도커로 말아두기.. 라고 하지만 실제 환경은 어렵다
- 관계 제약, 트리거, 저장 프로시저가 제대로 된 결과를 만들어내는지. => 테스트하기 어려우니 어지간하면 쓰지 말자

단순 일관성 뿐만 아니라, 중요 비즈니스 로직들의 성능 저하를 검토해야 하는 경우가 훨씬 많음.

## 보안

컴플라이언스가 대부분 가장 큰 포인트가 된다고 느낌

접근 제어 프로그램 굿

## 관측 가능성 및 모니터링

+ 드라이버 레벨의 분산 추적을 experimental하게 접근하고 있음. 다만, 성능 저하로 인한 우려가 커서 아직은 이정도까지 하지 않는 듯

## 데브옵스

데이터 스토어 유형 -> 배포 패턴 -> 보호 정책 -> 관측 가능성, 모니터링 -> automated CD를 사용하자.
